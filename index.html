
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>Hexagons on canvas</title>
</head>
<body>

<canvas id="hexagonCanvas" width="1000" height="720" style="border: 0; display: block; margin: 0 auto;">
Извините, ваш браузер не поддерживает тег canvas
</canvas>

<script type="text/javascript">
    var canvas = document.getElementById('hexagonCanvas');
    var hexHeight,
        hexRadius,
        hexRectangleHeight,
        hexRectangleWidth,
        hexagonAngle = Math.PI/6, // 30 градусов в радианах
        sideLength = 32, // длина стороны, в пикселях
        boardWidth = 100, // ширина "доски" по вертикали
        boardHeight = 100, // высота "доски" по вертикали
        isDrawing = false; // флаг для отслеживания рисования

    hexHeight = Math.sin(hexagonAngle) * sideLength;
    hexRadius = Math.cos(hexagonAngle) * sideLength;
    hexRectangleHeight = sideLength + 2 * hexHeight;
    hexRectangleWidth = 2 * hexRadius;

        var ctx = canvas.getContext('2d');
        ctx.fillStyle = "#000000";
        ctx.strokeStyle = "#333333";
        ctx.lineWidth = 2;
        drawBoard(ctx, boardWidth, boardHeight); // первичная отрисовка
        canvas.addEventListener("mousedown", function(eventInfo) { // слушатель нажатия кнопки мыши
            isDrawing = true; // устанавливаем флаг рисования в true
            draw(eventInfo); // вызываем функцию рисования
        });
        canvas.addEventListener("mousemove", function(eventInfo) { // слушатель перемещения мыши
            if (isDrawing) {
                draw(eventInfo); // вызываем функцию рисования, если кнопка мыши зажата
            }
        });
        canvas.addEventListener("mouseup", function(eventInfo) { // слушатель отпускания кнопки мыши
            isDrawing = false; // устанавливаем флаг рисования в false
        });
        canvas.addEventListener("mouseout", function(eventInfo) { // слушатель отпускания кнопки мыши
            isDrawing = false; // устанавливаем флаг рисования в false
        });

    function draw(eventInfo) {
        var x = eventInfo.offsetX ;
        var y = eventInfo.offsetY ;
        // console.log("eventInfo.offsetX ",eventInfo.offsetX);
        // console.log("eventInfo.offsetY ",eventInfo.offsetY);
        // console.log(" eventInfo.layerX ", eventInfo.layerX);
        // console.log("eventInfo.layerY ",eventInfo.layerY);
        var hexY = Math.floor(y / (hexHeight + sideLength));
        var hexX = Math.floor((x - (hexY % 2) * hexRadius) / hexRectangleWidth);
        var screenX = hexX * hexRectangleWidth + ((hexY % 2) * hexRadius);
        var screenY = hexY * (hexHeight + sideLength);
        
        console.log("hexX: ",hexX);
        console.log("hexY: ",hexY);
        console.log("screenX: ",screenX);
        console.log("screenY: ",screenY);
        console.log("eventInfo.offsetX ",eventInfo.offsetX);
        console.log("eventInfo.offsetY ",eventInfo.offsetY);
        // var centerX = hexX * 3/2 * sideLength + sideLength;
        // var centerY = hexY * (hexHeight + sideLength) + hexHeight;
        // Вычисление центра шестиугольника
        var centerX = screenX + hexRectangleWidth / 2;
    var centerY = screenY + hexRectangleHeight / 2;
    console.log("CenterX: ", Math.round( centerX), "CenterY:", centerY);
        // var centerX = hexX * 1.5 * sideLength + (hexY % 2) * 0.5 * sideLength + sideLength;
        // var centerY = hexY * (hexHeight + sideLength) + hexHeight;
        // console.log("CenterX: ", centerX);
        // console.log("CenterY: ", centerY);
        // ctx.fillStyle = "#008000";
        ctx.fillStyle = "green";
        drawHexagon(ctx, screenX, screenY, true);
    }

    function drawBoard(canvasContext, width, height) {
        for (var i = 0; i < width; i++) {
            for (var j = 0; j < height; j++) {
                drawHexagon(ctx, i * hexRectangleWidth + ((j % 2) * hexRadius),
                    j * (sideLength + hexHeight), false);
            }
        }
    }

    function drawHexagon(canvasContext, x, y, fill) {
        var fill = fill || false;
        canvasContext.beginPath();
        canvasContext.moveTo(x + hexRadius, y);
        canvasContext.lineTo(x + hexRectangleWidth, y + hexHeight);
        canvasContext.lineTo(x + hexRectangleWidth, y + hexHeight + sideLength);
        canvasContext.lineTo(x + hexRadius, y + hexRectangleHeight);
        canvasContext.lineTo(x, y + sideLength + hexHeight);
        canvasContext.lineTo(x, y + hexHeight);
        canvasContext.closePath();
        if (fill) canvasContext.fill();
        else canvasContext.stroke();
    }
</script>


</body>
</html>
